<div class="section">
	<div class="container">
		<h1 class="title is-3"><%= @shot.title %></h1>
		<div class="columns">
			<div class="column is-8">
				<span class="by has-text-grey-light">by</span>
				<div class="user-thumb">
					     <p class="image is-48x48 user-thumb">
        <% if @shot.user.avatar.blank? %>
        <%= image_tag 'no_avatar.png' %>
        <% else %>
       <%= image_tag @shot.user.avatar.to_s %>
       <% end %>
      </p>
				</div>
				<div class="user-name has-text-weight-bold"><%= @shot.user.name %></div>
				<div class="shot-time"><span class="has-text-grey-light">posted</span><span class="has-text-weight-semibold">
				</span></div>
			</div>	
		</div>

		<div class="columns">
			<div class="column is-8">
				<div class="shot-container">
					<div class="shot-full">
						 <%= image_tag @shot.user_shot_url unless @shot.user_shot.blank? %>
					</div>

					<% if user_signed_in? && (current_user.id == @shot.user_id) %>		
						<div class="buttons has-addons">
							<%= link_to 'Edit', edit_shot_path(@shot), class: "button" %>
							<%= link_to 'Delete', shot_path, class: "button", method: :delete, data: { confirm: 'Are you sure you want to delete this shot?'} %>
						</div>
					<% end %>

					<div class="content">
						<%= @shot.description %>
					</div>

			<div class="shot-full">
				<h2>gmap</h2>

<input id="address" type="textbox" value="GeekSalon">
<input type="button" value="Encode" onclick="codeAddress()">
<!-- 下の1行を追加 -->
<div id="display">何かが表示される、、、、！</div>

<div id='map'></div>

</div>



					<section class="comments">
						
						<h2 class="subtitle is-5"><%= pluralize(@shot.comments.count, 'Comment') %></h2>
							<%= render @shot.comments %>
						<hr />
						<% if user_signed_in? %>
							<div class="comment-form">
								<h3 class="subtitle is-3">Leave a response</h3>
								<%= render 'comments/form' %>
							</div>
						<% else %>
							<div class="content"><%= link_to 'Sign in', new_user_session_path %> to leave a response.</div>
						<% end %>
					</section>

				</div>
			</div>
			<div class="column is-3 is-offset-1">
				<div class="nav panel show-shot-analytics">
					<div class="panel-block views data">
						<span class="icon"><i class="fa fa-eye has-text-primary"></i></span>
						<%= pluralize(@shot.impressionist_count, 'View') %>
					</div>
					<div class="panel-block comments data">
						<span class="icon"><i class="fa fa-comment has-text-link"></i></span>
						<%= pluralize(@shot.comments.count, 'Comment') %>
					</div>
					<div class="panel-block likes data">
						<% if user_signed_in? %>
              <% if current_user.liked? @shot %>
                <%= link_to unlike_shot_path(@shot), method: :put, class: "unlike_shot" do %>
                  <span class="icon"><i class="fas fa-gem has-text-danger"></i></span>
                  <span class="vote_count"><%= pluralize(@shot.get_likes.size, 'Like') %></span>
                <% end %>
              <% else %>
                <%= link_to like_shot_path(@shot), method: :put, class: "like_shot" do %>
                  <span class="icon"><i class="fas fa-gem has-text-danger"></i></span>
                  <span class="vote_count"><%= pluralize(@shot.get_likes.size, 'Like') %></span>
                <% end %>
              <% end %>
            <% else %>
                <%= link_to like_shot_path(@shot), method: :put, class: "like_shot" do %>
                  <span class="icon"><i class="fas fa-gem has-text-danger"></i></span>
                  <span class="vote_count"><%= pluralize(@shot.get_likes.size, 'Like') %></span>
                <% end %>
            <% end %>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<script>
let map
let geocoder
// 下の1行を追加 
const display = document.getElementById('display')

function initMap(){
  geocoder = new google.maps.Geocoder()

  map = new google.maps.Map(document.getElementById('map'), {
    center: {lat: 40.7828, lng:-73.9653},
    zoom: 12,
  });

  marker = new google.maps.Marker({
    position:  {lat: 40.7828, lng:-73.9653},
    map: map
  });
}

function codeAddress(){
  let inputAddress = document.getElementById('address').value;

  geocoder.geocode( { 'address': inputAddress}, function(results, status) {
    if (status == 'OK') {
      map.setCenter(results[0].geometry.location);
      var marker = new google.maps.Marker({
          map: map,
          position: results[0].geometry.location
      });
      // 下の1行を追加 
      display.textContent = "検索結果：" + results[ 0 ].geometry.location
    } else {
      alert('該当する結果がありませんでした：' + status);
    }
  });   
}
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAd6VENRw-lVuallB-_deAYJSw9ChjrKo4&callback=initMap&language=en" async defer></script>

